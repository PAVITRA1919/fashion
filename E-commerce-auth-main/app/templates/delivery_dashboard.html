<!-- <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static',filename='styling.css') }}">
    <title>Delivery Person Dashboard</title>

</head>
<body>
    
    <div class="navbar">
        <div class="logo">FusionFits</div>
        
        <div class="search-bar">
            <input type="text" id="search" name="search" placeholder="Search">
            <button type="button">Search</button><br><br>
        </div>
        
        <div class="account-section">
            <a href="#">Cart</a>
            <div class="dropdown">
                <a href="#">Account</a>
                <div class="dropdown-content">
                    <a href="#">Sign In</a><br>
                    <a href="#">Logout</a>
                </div>
            </div>
        </div>
    </div>

    <div class="dashboard-container">
        <div class="header">Order Details</div>
        <div class="order-list">
            <div class="order">
                <img src="https://via.placeholder.com/150" alt="Product Image">
                <div class="order-details">
                    <strong>Order ID:</strong> #12345<br>
                    <strong>Name:</strong> John Doe<br>
                    <strong>Price:</strong> $50.00<br>
                    <strong>Place:</strong> New York, NY<br>
                    <strong>Quantity:</strong> 2<br>
                    <strong>Payment:</strong>
                    <select class="payment-select">
                        <option value="Cash on Delivery" selected>Cash on Delivery</option>
                    </select><br>
                <Strong>status:</Strong>
                <select class="status-select" onchange="updateStatus(12345, this.value)">
                    <option value="
                    ">Pending</option>
                    <option value="In Transit">In Transit</option>
                    <option value="Delivered">Delivered</option>
                </select>
                </div>
            </div>
            <div class="order">
                <img src="https://via.placeholder.com/150" alt="Product Image">
                <div class="order-details">
                    <strong>Order ID:</strong> #12346<br>
                    <strong>Name:</strong> Jane Smith<br>
                    <strong>Price:</strong> $75.00<br>
                    <strong>Place:</strong> Los Angeles, CA<br>
                    <strong>Quantity:</strong> 1<br>
                    <strong>Payment:</strong>
                    <select class="payment-select">
                        <option value="Cash on Delivery" selected>Cash on Delivery</option>
                    </select><br>
                    <Strong>status</Strong>
                    <select class="status-select" onchange="updateStatus(12346, this.value)">
                        <option value="Pending">Pending</option>
                        <option value="In Transit">In Transit</option>
                        <option value="Delivered">Delivered</option>
                    </select>
                </div>
            </div>
        </div>
        <button class="logout-btn" onclick="logout()">Logout</button>
    </div>

    <script>
        function updateStatus(orderId, status) {
            alert(`Order #${orderId} status updated to: ${status}`);
            // Here, you can add a fetch or AJAX call to update the status on the server
        }

        function logout() {
            alert('Logging out...');
            // Redirect to login page or clear session
            window.location.href = '/login';
        }

        // Simulate access control
        (function checkAccess() {
            const userRole = 'delivery_person'; // This should come from server-side logic
            if (userRole !== 'delivery_person') {
                alert('Access Denied! Only delivery personnel can view this page.');
                window.location.href = '/login';
            }
        })();
    </script>

<footer>
    FusionFits|&copy;2023 All rights reserved
</footer>

</body>
</html> -->





<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='styling.css') }}">
    <title>Delivery Dashboard</title>
</head>
<body>
    <div class="dashboard-container">
        <h1 align="center">Delivery Dashboard</h1>
        <div class="header">Order Details</div>
        <div class="order-list" id="order-list"> 
            
            {% if orders %}
                {% for order in orders %}
                <div class="order">
                <!-- <img src="https://via.placeholder.com/150" alt="Product Image"> -->
                <div class="order-details">
                        <p><strong>Order ID:</strong> {{ order.id }}</p>
                        <p><strong>Order Amount:</strong> ${{ order.order_amount }}</p>
                        <p><strong>Order Date:</strong> {{ order.order_date }}</p>
                        <!-- <p><strong>User ID:</strong> {{ order.user_id }}</p> -->
                        <!-- <p><strong>Product ID:</strong> {{ order.product_id }}</p> -->
                        <strong>Payment:</strong>
                        <select class="payment-select">
                            <option value="Cash on Delivery" selected>Cash on Delivery</option>
                        </select><br>
                        <p><strong>Status:</strong>
                            <select class="status-select" onchange="updateStatus({{order.id}} , this.value)">
                               
                                <option value="shipped" {% if order.status == 'shipped' %}selected{% endif %}>Shipped</option>
                                <option value="pending" {% if order.status == 'pending' %}selected{% endif %}>Pending</option>
                                <option value="delivered" {% if order.status == 'delivered' %}selected{% endif %}>Delivered</option>
                            </select>
                        </p>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <p style="text-align: center; width: 100%;">No orders available.</p>
            {% endif %}
        </div>
    </div>

    <script>
        function updateStatus(orderId, status) {
            fetch('/update_status', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ id: orderId, status: status }),
            })
            // .then({console.log(response => response.json())})
            .then(response => {
        console.log(response); // Log the response to debug
        return response.json(); // Parse the JSON response
    })
            .then(data => {
                if (data.message) {
                    alert(data.message);
                    // Update the status text directly in the DOM
                    const orderCard = document.querySelector(`[data-order-id="${orderId}"]`); 
                    const statusElement = orderCard.querySelector('.status-select');
                    statusElement.value = status; 
                } else if (data.error) {
                    alert(data.error);
                }
            })
            .catch(error => console.error('Error:', error));
        }
    </script>
</body>
</html>